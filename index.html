<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Edge of Chaos</title>
    <style>
        :root {
            --bg-primary: #0d0d0d;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --bg-card: #111111;
            --text-primary: #e5e5e5;
            --text-secondary: #888888;
            --text-muted: #555555;
            --accent-warm: #d4a574;
            --accent-cool: #7a9e9f;
            --accent-alert: #c75d5d;
            --accent-calm: #8b9a6d;
            --border-subtle: #222222;
            --border-light: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-weight: 300;
            letter-spacing: -0.02em;
        }

        h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            line-height: 1.1;
        }

        h2 {
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            margin-bottom: 1rem;
        }

        h3 {
            font-size: 1.3rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        p {
            color: var(--text-secondary);
            font-size: 1.05rem;
            max-width: 65ch;
        }

        /* Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 clamp(1rem, 5vw, 4rem);
        }

        section {
            padding: clamp(4rem, 10vw, 8rem) 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        /* Hero */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            border-bottom: none;
        }

        .hero-content {
            max-width: 900px;
        }

        .hero h1 {
            margin-bottom: 1.5rem;
        }

        .hero h1 span {
            color: var(--accent-warm);
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 3rem;
        }

        .scroll-hint {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .scroll-hint::after {
            content: '';
            width: 1px;
            height: 40px;
            background: linear-gradient(to bottom, var(--text-muted), transparent);
            animation: scrollPulse 2s infinite;
        }

        @keyframes scrollPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Navigation Dots */
        .nav-dots {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .nav-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot:hover,
        .nav-dot.active {
            background: var(--accent-warm);
            transform: scale(1.3);
        }

        /* Section Headers */
        .section-header {
            margin-bottom: 4rem;
        }

        .section-number {
            font-size: 0.8rem;
            color: var(--accent-warm);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: 1rem;
            display: block;
        }

        /* Demo Container */
        .demo-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: start;
        }

        @media (max-width: 900px) {
            .demo-container {
                grid-template-columns: 1fr;
                gap: 3rem;
            }
        }

        .demo-visual {
            position: relative;
            aspect-ratio: 4/5;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-subtle);
        }

        .demo-controls {
            position: sticky;
            top: 2rem;
        }

        /* Slider */
        .control-group {
            margin-bottom: 2.5rem;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 1rem;
        }

        .control-label span {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .control-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .slider-track {
            position: relative;
            height: 2px;
            background: var(--border-light);
            border-radius: 1px;
        }

        .slider-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: var(--accent-warm);
            border-radius: 1px;
            transition: width 0.1s ease;
        }

        input[type="range"] {
            width: 100%;
            height: 24px;
            -webkit-appearance: none;
            background: transparent;
            cursor: pointer;
            margin-top: -11px;
            position: relative;
            z-index: 2;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--text-primary);
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* Status Card */
        .status-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-calm);
        }

        .status-indicator.warning { background: var(--accent-warm); }
        .status-indicator.danger { background: var(--accent-alert); }

        .status-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .status-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.7;
        }

        /* Pattern Display */
        .pattern-display {
            display: flex;
            gap: 6px;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .pattern-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border-light);
            transition: all 0.2s ease;
        }

        .pattern-dot.active {
            background: var(--accent-warm);
            box-shadow: 0 0 12px rgba(212, 165, 116, 0.5);
        }

        /* Faucet Visual */
        .faucet-visual {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .faucet-head {
            position: absolute;
            top: 8%;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 100px;
        }

        .faucet-body {
            width: 40px;
            height: 60px;
            background: linear-gradient(90deg, #3a3a3a 0%, #4a4a4a 50%, #3a3a3a 100%);
            margin: 0 auto;
            border-radius: 4px 4px 0 0;
        }

        .faucet-spout {
            width: 50px;
            height: 25px;
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            margin: 0 auto;
            border-radius: 0 0 6px 6px;
        }

        .faucet-nozzle {
            width: 16px;
            height: 12px;
            background: #2a2a2a;
            margin: 0 auto;
            border-radius: 0 0 4px 4px;
        }

        .water-drop {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 16px;
            background: radial-gradient(ellipse at 30% 30%, rgba(150, 200, 220, 0.8), rgba(100, 150, 180, 0.6));
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0;
            filter: blur(0.5px);
        }

        .sink-basin {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 15%;
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
            border-top: 2px solid #2a2a2a;
        }

        .water-surface {
            position: absolute;
            bottom: 15%;
            left: 10%;
            right: 10%;
            height: 3px;
            background: rgba(100, 150, 180, 0.2);
            border-radius: 50%;
        }

        .ripple {
            position: absolute;
            bottom: calc(15% + 1px);
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border: 1px solid rgba(150, 200, 220, 0.4);
            border-radius: 50%;
            opacity: 0;
        }

        /* Candle Visual */
        .candle-visual {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 15%;
        }

        .candle {
            position: relative;
            width: 60px;
        }

        .candle-wax {
            width: 100%;
            height: 180px;
            background: linear-gradient(90deg, #e8dcc8 0%, #f5efe6 30%, #e8dcc8 100%);
            border-radius: 4px 4px 8px 8px;
            position: relative;
        }

        .candle-wax::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(180deg, #d4c4a8 0%, #e8dcc8 100%);
            border-radius: 4px 4px 0 0;
        }

        .candle-drip {
            position: absolute;
            width: 8px;
            height: 20px;
            background: linear-gradient(180deg, #e8dcc8, #d4c4a8);
            border-radius: 0 0 4px 4px;
            top: 30px;
            right: -2px;
        }

        .wick {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 15px;
            background: linear-gradient(180deg, #1a1a1a 0%, #333 100%);
            border-radius: 1px;
        }

        .flame-container {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
        }

        .flame {
            position: relative;
            width: 20px;
            height: 50px;
        }

        .flame-outer {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 45px;
            background: linear-gradient(180deg,
                rgba(255, 100, 0, 0) 0%,
                rgba(255, 150, 0, 0.6) 30%,
                rgba(255, 200, 50, 0.8) 60%,
                rgba(255, 220, 100, 1) 100%
            );
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            filter: blur(2px);
            transform-origin: bottom center;
        }

        .flame-inner {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 25px;
            background: linear-gradient(180deg,
                rgba(255, 255, 200, 0) 0%,
                rgba(255, 255, 220, 0.9) 50%,
                rgba(200, 220, 255, 1) 100%
            );
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            filter: blur(1px);
            transform-origin: bottom center;
        }

        .flame-glow {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255, 200, 100, 0.15) 0%, transparent 70%);
            pointer-events: none;
        }

        /* Bifurcation Canvas Section */
        .bifurcation-section {
            background: var(--bg-secondary);
        }

        .canvas-container {
            background: var(--bg-primary);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
        }

        .math-display {
            text-align: center;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            margin-bottom: 2rem;
        }

        .equation {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: var(--text-primary);
            letter-spacing: 0.05em;
        }

        .equation-label {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Metrics Display */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 1.8rem;
            color: var(--text-primary);
        }

        .metric-value.positive { color: var(--accent-alert); }
        .metric-value.negative { color: var(--accent-calm); }

        /* Iteration Display */
        .iteration-container {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .iteration-values {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .iteration-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .iteration-value.current {
            background: var(--accent-warm);
            color: var(--bg-primary);
            border-color: var(--accent-warm);
        }

        /* Button Styles */
        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border-light);
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        .btn.primary {
            background: var(--text-primary);
            color: var(--bg-primary);
            border-color: var(--text-primary);
        }

        .btn.primary:hover {
            background: var(--accent-warm);
            border-color: var(--accent-warm);
        }

        /* Regime Cards */
        .regime-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 700px) {
            .regime-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .regime-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .regime-card:hover {
            border-color: var(--border-light);
        }

        .regime-card.active {
            border-color: var(--accent-warm);
        }

        .regime-r {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .regime-name {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Consciousness Section */
        .consciousness-section {
            background: var(--bg-primary);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: center;
            margin: 3rem 0;
        }

        @media (max-width: 800px) {
            .comparison-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        .mind-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 2rem;
        }

        .mind-card h4 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .mind-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .mind-card.chaotic .mind-icon {
            background: rgba(199, 93, 93, 0.15);
        }

        .mind-card.ordered .mind-icon {
            background: rgba(139, 154, 109, 0.15);
        }

        .mind-traits {
            list-style: none;
        }

        .mind-traits li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .mind-traits li:last-child {
            border-bottom: none;
        }

        .transform-arrow {
            font-size: 2rem;
            color: var(--text-muted);
        }

        @media (max-width: 800px) {
            .transform-arrow {
                transform: rotate(90deg);
            }
        }

        /* Insight Box */
        .insight-box {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-left: 3px solid var(--accent-warm);
            border-radius: 0 12px 12px 0;
            padding: 2rem;
            margin: 3rem 0;
        }

        .insight-box h4 {
            color: var(--accent-warm);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        /* Examples Grid */
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .example-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .example-card h5 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .example-card p {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Constant Display */
        .constant-display {
            text-align: center;
            padding: 3rem;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin: 3rem 0;
        }

        .constant-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: clamp(2rem, 5vw, 3.5rem);
            color: var(--accent-warm);
            margin-bottom: 0.5rem;
        }

        .constant-name {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .constant-desc {
            color: var(--text-muted);
            font-size: 0.95rem;
            max-width: 500px;
            margin: 1rem auto 0;
        }

        /* Timeline */
        .timeline {
            position: relative;
            margin: 4rem 0;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg,
                var(--accent-calm) 0%,
                var(--accent-warm) 50%,
                var(--accent-alert) 100%
            );
        }

        .timeline-item {
            position: relative;
            padding: 1.5rem 0 3rem 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 1.75rem;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 2px solid var(--accent-warm);
            transform: translateX(-4px);
        }

        .timeline-item h4 {
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
        }

        .timeline-item p {
            font-size: 0.95rem;
        }

        /* Footer */
        footer {
            padding: 4rem 0;
            text-align: center;
            border-top: 1px solid var(--border-subtle);
        }

        footer p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin: 0 auto;
        }

        /* Animations */
        @keyframes flicker {
            0%, 100% { transform: translateX(-50%) scaleY(1) scaleX(1); opacity: 1; }
            25% { transform: translateX(-50%) scaleY(1.05) scaleX(0.95); opacity: 0.9; }
            50% { transform: translateX(-50%) scaleY(0.95) scaleX(1.05); opacity: 1; }
            75% { transform: translateX(-50%) scaleY(1.02) scaleX(0.98); opacity: 0.95; }
        }

        /* Time Series Mini */
        .time-series-mini {
            height: 180px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-top: 1.5rem;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-subtle);
        }

        .time-series-mini canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }

        .time-series-label {
            position: absolute;
            top: 12px;
            left: 12px;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            z-index: 1;
        }

        .time-series-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
        }

        /* Mobile Responsive Fixes */
        @media (max-width: 600px) {
            .time-series-mini {
                height: 200px;
                margin-top: 1rem;
            }

            .demo-visual {
                aspect-ratio: 3/4;
                min-height: 350px;
            }

            .pattern-display {
                padding: 1rem;
                gap: 4px;
            }

            .pattern-dot {
                width: 6px;
                height: 6px;
            }

            .status-card {
                padding: 1.25rem;
            }

            .control-value {
                font-size: 1.2rem;
            }

            .section-header {
                margin-bottom: 2rem;
            }

            section {
                padding: clamp(2rem, 8vw, 4rem) 0;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Dots -->
    <nav class="nav-dots">
        <div class="nav-dot active" data-section="hero"></div>
        <div class="nav-dot" data-section="faucet"></div>
        <div class="nav-dot" data-section="candle"></div>
        <div class="nav-dot" data-section="mathematics"></div>
        <div class="nav-dot" data-section="consciousness"></div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="container">
            <div class="hero-content">
                <h1>The Edge of <span>Chaos</span></h1>
                <p>
                    How simple systems become unpredictable. A visual journey through
                    the Feigenbaum scenario, the universal path from order to chaos
                    that governs dripping faucets, beating hearts, and perhaps
                    consciousness itself.
                </p>
            </div>
        </div>
        <div class="scroll-hint">Scroll</div>
    </section>

    <!-- Faucet Section -->
    <section id="faucet">
        <div class="container">
            <div class="section-header">
                <span class="section-number">01 — The Dripping Faucet</span>
                <h2>Where Rhythm Breaks Down</h2>
                <p>
                    A dripping faucet is one of the simplest demonstrations of chaos theory.
                    At low pressure, drops fall in perfect rhythm. Increase the pressure,
                    and watch order dissolve.
                </p>
            </div>

            <div class="demo-container">
                <div class="demo-visual">
                    <div class="faucet-visual" id="faucetVisual">
                        <div class="faucet-head">
                            <div class="faucet-body"></div>
                            <div class="faucet-spout"></div>
                            <div class="faucet-nozzle"></div>
                        </div>
                        <div id="faucetDropsContainer"></div>
                        <div class="water-surface"></div>
                        <div class="sink-basin"></div>
                    </div>
                </div>

                <div class="demo-controls">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Water Pressure</span>
                            <span class="control-value" id="faucetPressureValue">2.5</span>
                        </div>
                        <div class="slider-track">
                            <div class="slider-fill" id="faucetSliderFill" style="width: 25%"></div>
                        </div>
                        <input type="range" id="faucetSlider" min="1" max="4" step="0.01" value="2.5">
                    </div>

                    <div class="status-card" id="faucetStatus">
                        <div class="status-header">
                            <div class="status-indicator"></div>
                            <div class="status-title">Steady Rhythm</div>
                        </div>
                        <div class="status-description">
                            Each drop falls at a consistent interval. The system is predictable
                            and stable — you could time your watch to it.
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Drop Pattern</span>
                        </div>
                        <div class="pattern-display" id="faucetPattern">
                            <!-- Dots generated by JS -->
                        </div>
                    </div>

                    <div class="time-series-mini">
                        <div class="time-series-label">Time Series</div>
                        <canvas id="faucetTimeSeries"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Candle Section -->
    <section id="candle">
        <div class="container">
            <div class="section-header">
                <span class="section-number">02 — The Flickering Flame</span>
                <h2>Dancing on the Edge</h2>
                <p>
                    A candle flame responds to air currents in the same way. Still air produces
                    a steady flame. Add turbulence, and the flame begins its dance into chaos.
                </p>
            </div>

            <div class="demo-container">
                <div class="demo-visual" style="background: linear-gradient(180deg, #0a0a0a 0%, #111 100%);">
                    <div class="candle-visual">
                        <div class="candle">
                            <div class="flame-container" id="flameContainer">
                                <div class="flame-glow" id="flameGlow"></div>
                                <div class="flame">
                                    <div class="flame-outer" id="flameOuter"></div>
                                    <div class="flame-inner" id="flameInner"></div>
                                </div>
                            </div>
                            <div class="wick"></div>
                            <div class="candle-wax">
                                <div class="candle-drip"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="demo-controls">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Air Turbulence</span>
                            <span class="control-value" id="candleTurbulenceValue">Low</span>
                        </div>
                        <div class="slider-track">
                            <div class="slider-fill" id="candleSliderFill" style="width: 10%"></div>
                        </div>
                        <input type="range" id="candleSlider" min="1" max="4" step="0.01" value="1.4">
                    </div>

                    <div class="status-card" id="candleStatus">
                        <div class="status-header">
                            <div class="status-indicator"></div>
                            <div class="status-title">Steady Flame</div>
                        </div>
                        <div class="status-description">
                            The flame burns steadily, barely moving. In still air, the
                            combustion process is stable and predictable.
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Flame Oscillation</span>
                        </div>
                        <div class="pattern-display" id="candlePattern">
                            <!-- Dots generated by JS -->
                        </div>
                    </div>

                    <div class="time-series-mini">
                        <div class="time-series-label">Time Series</div>
                        <canvas id="candleTimeSeries"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Mathematics Section -->
    <section class="bifurcation-section" id="mathematics">
        <div class="container">
            <div class="section-header">
                <span class="section-number">03 — The Mathematics</span>
                <h2>One Equation, Infinite Complexity</h2>
                <p>
                    The logistic map is deceptively simple. Yet this single equation
                    produces the entire spectrum from perfect order to deterministic chaos.
                </p>
            </div>

            <div class="math-display">
                <div class="equation">x<sub>n+1</sub> = r · x<sub>n</sub> · (1 − x<sub>n</sub>)</div>
                <div class="equation-label">The Logistic Map</div>
            </div>

            <div class="canvas-container">
                <canvas id="bifurcationCanvas" width="1200" height="500"></canvas>
            </div>

            <div class="demo-container" style="margin-top: 2rem;">
                <div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Growth Parameter (r)</span>
                            <span class="control-value" id="mathRValue">3.2</span>
                        </div>
                        <div class="slider-track">
                            <div class="slider-fill" id="mathSliderFill" style="width: 40%"></div>
                        </div>
                        <input type="range" id="mathSlider" min="2.4" max="4" step="0.001" value="3.2">
                    </div>

                    <div class="regime-grid">
                        <div class="regime-card" data-r="2.8">
                            <div class="regime-r">r = 2.8</div>
                            <div class="regime-name">Period 1</div>
                        </div>
                        <div class="regime-card active" data-r="3.2">
                            <div class="regime-r">r = 3.2</div>
                            <div class="regime-name">Period 2</div>
                        </div>
                        <div class="regime-card" data-r="3.5">
                            <div class="regime-r">r = 3.5</div>
                            <div class="regime-name">Period 4</div>
                        </div>
                        <div class="regime-card" data-r="3.9">
                            <div class="regime-r">r = 3.9</div>
                            <div class="regime-name">Chaos</div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Period</div>
                            <div class="metric-value" id="periodValue">2</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Lyapunov Exponent</div>
                            <div class="metric-value negative" id="lyapunovValue">−0.318</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Stability</div>
                            <div class="metric-value" id="stabilityValue">Stable</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="iteration-container">
                        <h4 style="margin-bottom: 0.5rem;">Iteration Sequence</h4>
                        <p style="font-size: 0.9rem; margin-bottom: 1rem;">Watch the values evolve step by step</p>
                        <div class="iteration-values" id="iterationValues">
                            <!-- Generated by JS -->
                        </div>
                        <div class="btn-group" style="justify-content: center;">
                            <button class="btn primary" id="stepBtn">Step</button>
                            <button class="btn" id="autoBtn">Auto</button>
                            <button class="btn" id="resetBtn">Reset</button>
                        </div>
                    </div>

                    <div class="constant-display" style="margin-top: 2rem;">
                        <div class="constant-value">4.669201...</div>
                        <div class="constant-name">Feigenbaum Constant (δ)</div>
                        <div class="constant-desc">
                            Each period-doubling occurs 4.669× faster than the last.
                            This ratio is universal — it appears in all systems
                            undergoing period-doubling.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Consciousness Section -->
    <section class="consciousness-section" id="consciousness">
        <div class="container">
            <div class="section-header">
                <span class="section-number">04 — The Mind</span>
                <h2>Consciousness as Chaos Control</h2>
                <p>
                    Perhaps the most profound implication: consciousness may have evolved
                    as a mechanism to transform chaotic neural dynamics into linear,
                    predictable thought.
                </p>
            </div>

            <div class="comparison-grid">
                <div class="mind-card chaotic">
                    <h4>
                        <div class="mind-icon">◐</div>
                        Unconscious Processing
                    </h4>
                    <ul class="mind-traits">
                        <li>Parallel, nonlinear dynamics</li>
                        <li>High-dimensional state space</li>
                        <li>Sensitive to initial conditions</li>
                        <li>Dreams feel fragmented, surreal</li>
                        <li>Intuition emerges unpredictably</li>
                    </ul>
                </div>

                <div class="transform-arrow">→</div>

                <div class="mind-card ordered">
                    <h4>
                        <div class="mind-icon">○</div>
                        Conscious Experience
                    </h4>
                    <ul class="mind-traits">
                        <li>Sequential, linear narrative</li>
                        <li>Focused, reduced dimensionality</li>
                        <li>Predictable cause-and-effect</li>
                        <li>Coherent sense of time</li>
                        <li>Rational decision-making</li>
                    </ul>
                </div>
            </div>

            <div class="insight-box">
                <h4>The Core Insight</h4>
                <p>
                    The brain receives chaotic sensory input from an inherently nonlinear world.
                    Consciousness may function as a "dimensionality reduction" system —
                    compressing the swirling complexity of neural activity into simple,
                    actionable narratives. This is why focus requires effort (you're
                    fighting the brain's natural complexity), and why meditation can
                    feel strange (you're glimpsing the unfiltered chaos beneath).
                </p>
            </div>

            <h3 style="margin-top: 3rem; margin-bottom: 1rem;">The Period-Doubling Limit</h3>
            <p>
                Studies suggest conscious attention can track approximately 7±2 items —
                potentially reflecting a fundamental period-doubling constraint in
                neural information processing.
            </p>

            <div class="examples-grid">
                <div class="example-card">
                    <h5>Music & Emotion</h5>
                    <p>
                        Music lives at the edge of chaos — patterns with just enough
                        variation. Too predictable becomes boring; too chaotic becomes noise.
                    </p>
                </div>
                <div class="example-card">
                    <h5>Creative Insight</h5>
                    <p>
                        Breakthroughs often come when linear thinking relaxes —
                        allowing chaotic unconscious processes to surface briefly.
                    </p>
                </div>
                <div class="example-card">
                    <h5>Meditation States</h5>
                    <p>
                        Deep meditation may shift brain dynamics toward more complex
                        states — experiencing reality with less filtering.
                    </p>
                </div>
                <div class="example-card">
                    <h5>Overwhelm & Anxiety</h5>
                    <p>
                        Feeling overwhelmed might be consciousness struggling to
                        linearize too much chaotic input simultaneously.
                    </p>
                </div>
            </div>

            <h3 style="margin-top: 4rem; margin-bottom: 2rem;">The Journey from Order to Chaos</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <h4 style="color: var(--accent-calm);">Stage 1: Fixed Point</h4>
                    <p>
                        The system settles to a single stable value. Like a healthy
                        heartbeat or a steady drip — perfectly predictable, period one.
                    </p>
                </div>
                <div class="timeline-item">
                    <h4 style="color: var(--accent-cool);">Stage 2: First Bifurcation</h4>
                    <p>
                        Stability breaks. The system now oscillates between two states.
                        Long-short-long-short. The period has doubled.
                    </p>
                </div>
                <div class="timeline-item">
                    <h4 style="color: var(--accent-warm);">Stage 3: The Cascade</h4>
                    <p>
                        Doubling accelerates: 2→4→8→16... Each bifurcation occurs
                        4.669× faster. The system approaches the edge.
                    </p>
                </div>
                <div class="timeline-item">
                    <h4 style="color: var(--accent-alert);">Stage 4: Chaos</h4>
                    <p>
                        The pattern never repeats. Yet it's deterministic — same
                        initial conditions always produce the same trajectory.
                        Predictable in principle, unknowable in practice.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>
                The same mathematics governs dripping faucets, flickering flames,
                weather systems, and perhaps the boundary between unconscious
                chaos and conscious order.
            </p>
        </div>
    </footer>

    <script>
        // ============================================================
        // UTILITY FUNCTIONS
        // ============================================================

        function logisticMap(x, r) {
            return r * x * (1 - x);
        }

        function calculateLyapunov(r, iterations = 1000) {
            let x = 0.5;
            let sum = 0;
            for (let i = 0; i < 100; i++) x = logisticMap(x, r);
            for (let i = 0; i < iterations; i++) {
                const derivative = Math.abs(r * (1 - 2 * x));
                if (derivative > 0) sum += Math.log(derivative);
                x = logisticMap(x, r);
            }
            return sum / iterations;
        }

        function detectPeriod(r, tolerance = 0.0001) {
            let x = 0.5;
            for (let i = 0; i < 1000; i++) x = logisticMap(x, r);
            const values = [];
            for (let i = 0; i < 64; i++) {
                x = logisticMap(x, r);
                values.push(x);
            }
            for (let period of [1, 2, 4, 8, 16, 32]) {
                let isPeriodic = true;
                for (let i = 0; i < 32 && isPeriodic; i++) {
                    if (Math.abs(values[i] - values[i + period]) > tolerance) {
                        isPeriodic = false;
                    }
                }
                if (isPeriodic) return period;
            }
            return '∞';
        }

        // ============================================================
        // FAUCET SIMULATION
        // ============================================================

        const faucetState = {
            pressure: 2.5,
            x: 0.5,
            drops: [],
            pattern: [],
            timeSeriesData: [],
            maxPattern: 24,
            maxTimeSeries: 120
        };

        function initFaucetPattern() {
            const container = document.getElementById('faucetPattern');
            container.innerHTML = '';
            for (let i = 0; i < faucetState.maxPattern; i++) {
                const dot = document.createElement('div');
                dot.className = 'pattern-dot';
                container.appendChild(dot);
            }
        }

        function updateFaucetStatus() {
            const p = faucetState.pressure;
            const status = document.getElementById('faucetStatus');
            const indicator = status.querySelector('.status-indicator');
            const title = status.querySelector('.status-title');
            const desc = status.querySelector('.status-description');

            indicator.className = 'status-indicator';

            if (p < 2.2) {
                title.textContent = 'Steady Rhythm';
                desc.textContent = 'Each drop falls at a consistent interval. The system is predictable and stable — you could time your watch to it.';
            } else if (p < 3.0) {
                indicator.classList.add('warning');
                title.textContent = 'Double Beat';
                desc.textContent = 'The rhythm has split. Drops now alternate between two intervals — long, short, long, short. Period-2 oscillation.';
            } else if (p < 3.5) {
                indicator.classList.add('warning');
                title.textContent = 'Complex Pattern';
                desc.textContent = 'Four distinct intervals emerge. The pattern is harder to follow, but still repeating. Period-4 regime.';
            } else {
                indicator.classList.add('danger');
                title.textContent = 'Chaotic Dripping';
                desc.textContent = 'No discernible pattern. Each drop is determined by physics, yet practically unpredictable. Welcome to chaos.';
            }

            document.getElementById('faucetPressureValue').textContent = p.toFixed(2);
            document.getElementById('faucetSliderFill').style.width = ((p - 1) / 3 * 100) + '%';
        }

        function createFaucetDrop() {
            const visual = document.getElementById('faucetVisual');
            const drop = document.createElement('div');
            drop.className = 'water-drop';
            drop.style.top = '115px';
            drop.style.opacity = '1';
            document.getElementById('faucetDropsContainer').appendChild(drop);

            let pos = 115;
            const containerHeight = visual.offsetHeight;
            const targetY = containerHeight * 0.82;

            const fall = () => {
                pos += 4;
                drop.style.top = pos + 'px';

                if (pos >= targetY) {
                    drop.remove();
                    createRipple();
                    updateFaucetPattern();
                } else {
                    requestAnimationFrame(fall);
                }
            };
            requestAnimationFrame(fall);
        }

        function createRipple() {
            const visual = document.getElementById('faucetVisual');
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.cssText = `
                position: absolute;
                bottom: 15%;
                left: 50%;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                border: 1px solid rgba(150, 200, 220, 0.6);
                border-radius: 50%;
                pointer-events: none;
            `;
            visual.appendChild(ripple);

            let size = 0;
            let opacity = 0.6;
            const expand = () => {
                size += 2;
                opacity -= 0.02;
                ripple.style.width = size + 'px';
                ripple.style.height = (size / 3) + 'px';
                ripple.style.opacity = opacity;

                if (opacity > 0) {
                    requestAnimationFrame(expand);
                } else {
                    ripple.remove();
                }
            };
            requestAnimationFrame(expand);
        }

        function updateFaucetPattern() {
            faucetState.pattern.push(Date.now());
            if (faucetState.pattern.length > faucetState.maxPattern) {
                faucetState.pattern.shift();
            }

            const dots = document.querySelectorAll('#faucetPattern .pattern-dot');
            dots.forEach((dot, i) => {
                dot.classList.remove('active');
                if (i === faucetState.pattern.length - 1) {
                    dot.classList.add('active');
                }
            });

            // Update time series
            faucetState.x = logisticMap(faucetState.x, 2.5 + (faucetState.pressure - 1) * 0.5);
            faucetState.timeSeriesData.push(faucetState.x);
            if (faucetState.timeSeriesData.length > faucetState.maxTimeSeries) {
                faucetState.timeSeriesData.shift();
            }
            drawFaucetTimeSeries();
        }

        function drawFaucetTimeSeries() {
            const canvas = document.getElementById('faucetTimeSeries');
            const container = canvas.parentElement;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            const w = container.clientWidth;
            const h = container.clientHeight;

            canvas.width = w * dpr;
            canvas.height = h * dpr;
            ctx.scale(dpr, dpr);
            const padding = { top: 30, bottom: 15, left: 10, right: 10 };
            const graphH = h - padding.top - padding.bottom;
            const graphW = w - padding.left - padding.right;

            ctx.clearRect(0, 0, w, h);

            // Draw grid lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (graphH * i / 4);
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(w - padding.right, y);
                ctx.stroke();
            }

            if (faucetState.timeSeriesData.length < 2) return;

            // Draw the line
            ctx.strokeStyle = 'rgba(212, 165, 116, 0.8)';
            ctx.lineWidth = 1.5;
            ctx.beginPath();

            faucetState.timeSeriesData.forEach((val, i) => {
                const x = padding.left + (i / (faucetState.maxTimeSeries - 1)) * graphW;
                const y = padding.top + graphH - (val * graphH * 0.9) - graphH * 0.05;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw dots for recent points
            const recentCount = Math.min(20, faucetState.timeSeriesData.length);
            const startIdx = faucetState.timeSeriesData.length - recentCount;

            faucetState.timeSeriesData.slice(-recentCount).forEach((val, i) => {
                const idx = startIdx + i;
                const x = padding.left + (idx / (faucetState.maxTimeSeries - 1)) * graphW;
                const y = padding.top + graphH - (val * graphH * 0.9) - graphH * 0.05;
                const alpha = 0.3 + (i / recentCount) * 0.7;
                const size = 2 + (i / recentCount) * 2;

                ctx.fillStyle = `rgba(212, 165, 116, ${alpha})`;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw y-axis labels
            ctx.fillStyle = 'rgba(85, 85, 85, 0.8)';
            ctx.font = '10px -apple-system, sans-serif';
            ctx.fillText('1.0', w - padding.right - 20, padding.top + 4);
            ctx.fillText('0.0', w - padding.right - 20, h - padding.bottom - 2);
        }

        function getNextFaucetInterval() {
            const r = 2.5 + (faucetState.pressure - 1) * 0.5;
            faucetState.x = logisticMap(faucetState.x, r);
            const base = 600 - (faucetState.pressure - 1) * 100;
            const variation = faucetState.x * 300;
            return Math.max(80, base - variation + 150);
        }

        let faucetTimeout;
        function faucetDripLoop() {
            createFaucetDrop();
            faucetTimeout = setTimeout(faucetDripLoop, getNextFaucetInterval());
        }

        document.getElementById('faucetSlider').addEventListener('input', (e) => {
            faucetState.pressure = parseFloat(e.target.value);
            faucetState.x = 0.5;
            updateFaucetStatus();
        });

        // ============================================================
        // CANDLE SIMULATION
        // ============================================================

        const candleState = {
            turbulence: 1.4,
            x: 0.5,
            pattern: [],
            timeSeriesData: [],
            maxPattern: 24,
            maxTimeSeries: 120
        };

        function initCandlePattern() {
            const container = document.getElementById('candlePattern');
            container.innerHTML = '';
            for (let i = 0; i < candleState.maxPattern; i++) {
                const dot = document.createElement('div');
                dot.className = 'pattern-dot';
                container.appendChild(dot);
            }
        }

        function updateCandleStatus() {
            const t = candleState.turbulence;
            const status = document.getElementById('candleStatus');
            const indicator = status.querySelector('.status-indicator');
            const title = status.querySelector('.status-title');
            const desc = status.querySelector('.status-description');

            indicator.className = 'status-indicator';

            let label = 'Low';
            if (t < 2.0) {
                title.textContent = 'Steady Flame';
                desc.textContent = 'The flame burns steadily, barely moving. In still air, the combustion process is stable and predictable.';
                label = 'Low';
            } else if (t < 2.8) {
                indicator.classList.add('warning');
                title.textContent = 'Gentle Sway';
                desc.textContent = 'The flame begins to oscillate between two positions. A subtle breeze creates period-2 motion.';
                label = 'Medium';
            } else if (t < 3.4) {
                indicator.classList.add('warning');
                title.textContent = 'Complex Dance';
                desc.textContent = 'Multiple oscillation modes emerge. The flame traces intricate but still repeating patterns.';
                label = 'High';
            } else {
                indicator.classList.add('danger');
                title.textContent = 'Chaotic Flicker';
                desc.textContent = 'The flame dances unpredictably, responding to turbulent air currents in infinitely complex ways.';
                label = 'Chaotic';
            }

            document.getElementById('candleTurbulenceValue').textContent = label;
            document.getElementById('candleSliderFill').style.width = ((t - 1) / 3 * 100) + '%';
        }

        function animateFlame() {
            const r = 2.5 + (candleState.turbulence - 1) * 0.5;
            candleState.x = logisticMap(candleState.x, r);

            const outer = document.getElementById('flameOuter');
            const inner = document.getElementById('flameInner');
            const glow = document.getElementById('flameGlow');

            const baseAngle = (candleState.x - 0.5) * 30;
            const scaleX = 0.85 + candleState.x * 0.3;
            const scaleY = 0.9 + (1 - candleState.x) * 0.2;

            outer.style.transform = `translateX(-50%) rotate(${baseAngle}deg) scaleX(${scaleX}) scaleY(${scaleY})`;
            inner.style.transform = `translateX(-50%) rotate(${baseAngle * 0.5}deg) scaleX(${scaleX * 0.9}) scaleY(${scaleY})`;

            const glowSize = 60 + candleState.x * 40;
            glow.style.width = glowSize + 'px';
            glow.style.height = glowSize + 'px';
            glow.style.opacity = 0.1 + candleState.x * 0.1;

            // Update pattern
            candleState.pattern.push(candleState.x);
            if (candleState.pattern.length > candleState.maxPattern) {
                candleState.pattern.shift();
            }

            const dots = document.querySelectorAll('#candlePattern .pattern-dot');
            dots.forEach((dot, i) => {
                dot.classList.remove('active');
                if (i < candleState.pattern.length) {
                    const intensity = candleState.pattern[i];
                    if (intensity > 0.5) {
                        dot.classList.add('active');
                    }
                }
            });

            // Time series
            candleState.timeSeriesData.push(candleState.x);
            if (candleState.timeSeriesData.length > candleState.maxTimeSeries) {
                candleState.timeSeriesData.shift();
            }
            drawCandleTimeSeries();
        }

        function drawCandleTimeSeries() {
            const canvas = document.getElementById('candleTimeSeries');
            const container = canvas.parentElement;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            const w = container.clientWidth;
            const h = container.clientHeight;

            canvas.width = w * dpr;
            canvas.height = h * dpr;
            ctx.scale(dpr, dpr);
            const padding = { top: 30, bottom: 15, left: 10, right: 10 };
            const graphH = h - padding.top - padding.bottom;
            const graphW = w - padding.left - padding.right;

            ctx.clearRect(0, 0, w, h);

            // Draw grid lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (graphH * i / 4);
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(w - padding.right, y);
                ctx.stroke();
            }

            if (candleState.timeSeriesData.length < 2) return;

            // Draw the line
            ctx.strokeStyle = 'rgba(212, 165, 116, 0.8)';
            ctx.lineWidth = 1.5;
            ctx.beginPath();

            candleState.timeSeriesData.forEach((val, i) => {
                const x = padding.left + (i / (candleState.maxTimeSeries - 1)) * graphW;
                const y = padding.top + graphH - (val * graphH * 0.9) - graphH * 0.05;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw dots for recent points
            const recentCount = Math.min(20, candleState.timeSeriesData.length);
            const startIdx = candleState.timeSeriesData.length - recentCount;

            candleState.timeSeriesData.slice(-recentCount).forEach((val, i) => {
                const idx = startIdx + i;
                const x = padding.left + (idx / (candleState.maxTimeSeries - 1)) * graphW;
                const y = padding.top + graphH - (val * graphH * 0.9) - graphH * 0.05;
                const alpha = 0.3 + (i / recentCount) * 0.7;
                const size = 2 + (i / recentCount) * 2;

                ctx.fillStyle = `rgba(212, 165, 116, ${alpha})`;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw y-axis labels
            ctx.fillStyle = 'rgba(85, 85, 85, 0.8)';
            ctx.font = '10px -apple-system, sans-serif';
            ctx.fillText('1.0', w - padding.right - 20, padding.top + 4);
            ctx.fillText('0.0', w - padding.right - 20, h - padding.bottom - 2);
        }

        document.getElementById('candleSlider').addEventListener('input', (e) => {
            candleState.turbulence = parseFloat(e.target.value);
            candleState.x = 0.5;
            updateCandleStatus();
        });

        let flameInterval;
        function startFlameAnimation() {
            const speed = Math.max(30, 100 - (candleState.turbulence - 1) * 20);
            flameInterval = setInterval(animateFlame, speed);
        }

        // ============================================================
        // BIFURCATION DIAGRAM
        // ============================================================

        const mathState = {
            r: 3.2,
            x: 0.5,
            iterations: [],
            maxIterations: 15,
            autoRunning: false
        };

        function drawBifurcation() {
            const canvas = document.getElementById('bifurcationCanvas');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            const displayWidth = canvas.offsetWidth;
            const displayHeight = 500;

            canvas.width = displayWidth * dpr;
            canvas.height = displayHeight * dpr;
            canvas.style.height = displayHeight + 'px';
            ctx.scale(dpr, dpr);

            const w = displayWidth;
            const h = displayHeight;

            ctx.fillStyle = '#0d0d0d';
            ctx.fillRect(0, 0, w, h);

            const rMin = 2.4;
            const rMax = 4.0;
            const iterations = 300;
            const plotPoints = 150;

            // Draw bifurcation
            for (let px = 0; px < w; px++) {
                const rVal = rMin + (px / w) * (rMax - rMin);
                let x = 0.5;

                for (let i = 0; i < iterations; i++) {
                    x = logisticMap(x, rVal);
                }

                for (let i = 0; i < plotPoints; i++) {
                    x = logisticMap(x, rVal);
                    const py = h - (x * h * 0.9) - h * 0.05;

                    const alpha = 0.15 + (rVal - rMin) / (rMax - rMin) * 0.2;
                    ctx.fillStyle = `rgba(212, 165, 116, ${alpha})`;
                    ctx.fillRect(px, py, 1.5, 1.5);
                }
            }

            // Current r line
            const currentX = ((mathState.r - rMin) / (rMax - rMin)) * w;
            ctx.strokeStyle = 'rgba(199, 93, 93, 0.8)';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(currentX, 0);
            ctx.lineTo(currentX, h);
            ctx.stroke();
            ctx.setLineDash([]);

            // Labels
            ctx.fillStyle = '#555';
            ctx.font = '11px -apple-system, sans-serif';
            ctx.fillText('r = 2.4', 8, h - 8);
            ctx.fillText('r = 4.0', w - 50, h - 8);
            ctx.fillText('x = 1', 8, 18);
            ctx.fillText('x = 0', 8, h - 25);

            // Bifurcation markers
            const markers = [
                { r: 3.0, label: 'P2' },
                { r: 3.449, label: 'P4' },
                { r: 3.5699, label: '∞' }
            ];

            ctx.fillStyle = '#666';
            markers.forEach(m => {
                const mx = ((m.r - rMin) / (rMax - rMin)) * w;
                ctx.fillText(m.label, mx - 8, 18);
            });
        }

        function updateMathDisplay() {
            const r = mathState.r;

            document.getElementById('mathRValue').textContent = r.toFixed(3);
            document.getElementById('mathSliderFill').style.width = ((r - 2.4) / 1.6 * 100) + '%';

            const period = detectPeriod(r);
            const lyapunov = calculateLyapunov(r);

            document.getElementById('periodValue').textContent = period;

            const lyapEl = document.getElementById('lyapunovValue');
            lyapEl.textContent = lyapunov.toFixed(3);
            lyapEl.className = 'metric-value ' + (lyapunov < 0 ? 'negative' : 'positive');

            document.getElementById('stabilityValue').textContent = lyapunov < 0 ? 'Stable' : 'Chaotic';

            // Update regime cards
            document.querySelectorAll('.regime-card').forEach(card => {
                const cardR = parseFloat(card.dataset.r);
                card.classList.toggle('active', Math.abs(r - cardR) < 0.15);
            });

            drawBifurcation();
        }

        function updateIterationDisplay() {
            const container = document.getElementById('iterationValues');
            container.innerHTML = '';

            mathState.iterations.forEach((val, i) => {
                const div = document.createElement('div');
                div.className = 'iteration-value' + (i === mathState.iterations.length - 1 ? ' current' : '');
                div.textContent = val.toFixed(4);
                container.appendChild(div);
            });
        }

        function stepIteration() {
            mathState.x = logisticMap(mathState.x, mathState.r);
            mathState.iterations.push(mathState.x);
            if (mathState.iterations.length > mathState.maxIterations) {
                mathState.iterations.shift();
            }
            updateIterationDisplay();
        }

        function resetIteration() {
            mathState.x = 0.5;
            mathState.iterations = [0.5];
            updateIterationDisplay();
        }

        let autoInterval;
        function toggleAuto() {
            mathState.autoRunning = !mathState.autoRunning;
            document.getElementById('autoBtn').textContent = mathState.autoRunning ? 'Stop' : 'Auto';

            if (mathState.autoRunning) {
                autoInterval = setInterval(stepIteration, 200);
            } else {
                clearInterval(autoInterval);
            }
        }

        document.getElementById('mathSlider').addEventListener('input', (e) => {
            mathState.r = parseFloat(e.target.value);
            resetIteration();
            updateMathDisplay();
        });

        document.getElementById('stepBtn').addEventListener('click', stepIteration);
        document.getElementById('autoBtn').addEventListener('click', toggleAuto);
        document.getElementById('resetBtn').addEventListener('click', resetIteration);

        document.querySelectorAll('.regime-card').forEach(card => {
            card.addEventListener('click', () => {
                mathState.r = parseFloat(card.dataset.r);
                document.getElementById('mathSlider').value = mathState.r;
                resetIteration();
                updateMathDisplay();
            });
        });

        // ============================================================
        // NAVIGATION
        // ============================================================

        const sections = ['hero', 'faucet', 'candle', 'mathematics', 'consciousness'];
        const navDots = document.querySelectorAll('.nav-dot');

        function updateNavigation() {
            const scrollPos = window.scrollY + window.innerHeight / 2;

            sections.forEach((id, i) => {
                const section = document.getElementById(id);
                if (section) {
                    const top = section.offsetTop;
                    const bottom = top + section.offsetHeight;

                    if (scrollPos >= top && scrollPos < bottom) {
                        navDots.forEach(dot => dot.classList.remove('active'));
                        navDots[i].classList.add('active');
                    }
                }
            });
        }

        navDots.forEach((dot, i) => {
            dot.addEventListener('click', () => {
                const section = document.getElementById(sections[i]);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        window.addEventListener('scroll', updateNavigation);

        // ============================================================
        // INITIALIZATION
        // ============================================================

        window.addEventListener('load', () => {
            initFaucetPattern();
            initCandlePattern();
            updateFaucetStatus();
            updateCandleStatus();
            updateMathDisplay();
            resetIteration();

            faucetDripLoop();
            startFlameAnimation();

            // Handle resize
            window.addEventListener('resize', () => {
                drawBifurcation();
                drawFaucetTimeSeries();
                drawCandleTimeSeries();
            });
        });
    </script>
</body>
</html>
